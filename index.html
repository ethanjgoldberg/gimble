<html>
<head>
<title>gimbleLOCK</title>
<script src=gimble.js></script>
<script>
var roomChange;

function go() {
	var s = 24;
	var maxLengths = 2;
	var numRooms = 4;

	var canvas = document.getElementById('c');
	WIDTH = canvas.width = SQUARE * s / 2;
	HEIGHT = canvas.height = SQUARE * s / 2;
	var ctx = canvas.getContext('2d');

	var min_cam_x = 0;
	var max_cam_y = HEIGHT;
	var min_cam_y = 0;

	var room = 0;
	var rooms = [];
	for (var i = 0; i < numRooms; i++) {
		rooms.push(new Room(s * Math.floor(Math.random() * maxLengths)+s, s, numRooms));
	}
	var gimble = new Gimble (2 * SQUARE, HEIGHT*2 - 2 * SQUARE);
	min_cam_y = rooms[room].max_j * SQUARE;
	max_cam_x = rooms[room].width * SQUARE - WIDTH + SQUARE;
	var cam = {x: 0, y: 0};

	(function tick() {
	 window.requestAnimationFrame(tick);

	 gimble.tick(rooms[room]);
	 rooms[room].tick(gimble);

	 ctx.save();
	 ctx.clearRect(0, 0, WIDTH, HEIGHT);
	 cam.x = gimble.x - WIDTH / 2;
	 cam.y = gimble.y - HEIGHT / 2;
	 if (cam.x > max_cam_x) cam.x = max_cam_x;
	 if (cam.y > max_cam_y) cam.y = max_cam_y;
	 if (cam.x < min_cam_x) cam.x = min_cam_x;
	 if (cam.y < min_cam_y) cam.y = min_cam_y;
	 //crawlie.tick(gimble);

	 ctx.translate(-cam.x, -cam.y);
	 ctx.globalCompositeOperation = 'source-over';
	 rooms[room].drawDark(ctx, cam);
	 gimble.drawDark(ctx);
	 ctx.globalCompositeOperation = 'source-atop';
	 rooms[room].draw(ctx, cam);
	 ctx.globalCompositeOperation = 'source-over';
	 gimble.draw(ctx);
	 ctx.globalCompositeOperation = 'destination-over';
	 ctx.fillStyle = 'black';
	 ctx.fillRect(cam.x, cam.y, WIDTH, HEIGHT);

	 ctx.restore();
	 gimble.drawStats(ctx);

	 })();
}
</script>
</head>
<body onLoad=go()>
<center>
	<canvas id=c style="border:3px solid grey"></canvas>
</center>
</body>
</html>
